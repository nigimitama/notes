Traceback (most recent call last):
  File "/usr/local/lib/python3.10/site-packages/jupyter_core/utils/__init__.py", line 154, in wrapped
    asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.10/site-packages/jupyter_cache/executors/utils.py", line 58, in single_nb_execution
    executenb(
  File "/usr/local/lib/python3.10/site-packages/nbclient/client.py", line 1319, in execute
    return NotebookClient(nb=nb, resources=resources, km=km, **kwargs).execute()
  File "/usr/local/lib/python3.10/site-packages/jupyter_core/utils/__init__.py", line 158, in wrapped
    return loop.run_until_complete(inner)
  File "/usr/local/lib/python3.10/asyncio/base_events.py", line 649, in run_until_complete
    return future.result()
  File "/usr/local/lib/python3.10/site-packages/nbclient/client.py", line 709, in async_execute
    await self.async_execute_cell(
  File "/usr/local/lib/python3.10/site-packages/nbclient/client.py", line 1062, in async_execute_cell
    await self._check_raise_for_error(cell, cell_index, exec_reply)
  File "/usr/local/lib/python3.10/site-packages/nbclient/client.py", line 918, in _check_raise_for_error
    raise CellExecutionError.from_cell_and_msg(cell, exec_reply_content)
nbclient.exceptions.CellExecutionError: An error occurred while executing the following cell:
------------------
import numpy as np

def svd_from_eig(A):
    AtA = A.T @ A

    # 固有値分解（V: 右特異ベクトル）
    eigenvalues, V = np.linalg.eig(AtA)
    
    # 固有値の実数部分とインデックスを昇順で並び替え
    idx = np.argsort(eigenvalues)[::-1]
    eigenvalues = eigenvalues[idx]
    V = V[:, idx]

    # 特異値の計算（負値を0に修正）
    singular_values = np.sqrt(np.clip(eigenvalues.real, 0, None))

    # 左特異ベクトルの計算
    U = []
    for i in range(len(singular_values)):
        if singular_values[i] > 1e-10:
            u = A @ V[:, i] / singular_values[i]
        else:
            # ランク欠損時の直交補完（ここではゼロベクトル）
            u = np.zeros(A.shape[0])
        U.append(u)
    U = np.column_stack(U)

    # 必要ならUの直交補完を追加（ここでは省略）

    # Σ 行列の構築
    m, n = A.shape
    Sigma = np.zeros((m, n))
    for i in range(min(m, n)):
        Sigma[i, i] = singular_values[i]

    return U, Sigma, V


U, S, V = svd_from_eig(P)

# 検証
print("U:\n", U)
print("Σ:\n", S)
print("V:\n", V)
print("再構成:\n", U @ S @ V.T)

------------------

----- stdout -----
U:
 [[-0.2298477   0.88346102]
 [-0.52474482  0.24078249]
 [-0.81964194 -0.40189603]]
Σ:
 [[9.52551809 0.        ]
 [0.         0.51430058]
 [0.         0.        ]]
V:
 [[-0.61962948 -0.78489445]
 [-0.78489445  0.61962948]]
------------------

[0;31m---------------------------------------------------------------------------[0m
[0;31mValueError[0m                                Traceback (most recent call last)
Cell [0;32mIn[6], line 45[0m
[1;32m     43[0m [38;5;28mprint[39m([38;5;124m"[39m[38;5;124mΣ:[39m[38;5;130;01m\n[39;00m[38;5;124m"[39m, S)
[1;32m     44[0m [38;5;28mprint[39m([38;5;124m"[39m[38;5;124mV:[39m[38;5;130;01m\n[39;00m[38;5;124m"[39m, V)
[0;32m---> 45[0m [38;5;28mprint[39m([38;5;124m"[39m[38;5;124m再構成:[39m[38;5;130;01m\n[39;00m[38;5;124m"[39m, [43mU[49m[43m [49m[38;5;241;43m@[39;49m[43m [49m[43mS[49m [38;5;241m@[39m V[38;5;241m.[39mT)

[0;31mValueError[0m: matmul: Input operand 1 has a mismatch in its core dimension 0, with gufunc signature (n?,k),(k,m?)->(n?,m?) (size 3 is different from 2)

